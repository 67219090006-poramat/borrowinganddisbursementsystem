<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Sarabun', sans-serif;
    }
    
    .sidebar {
      transition: transform 0.3s ease;
    }
    
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        position: fixed;
        z-index: 100;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0 !important;
      }
    }
    
    .menu-item {
      transition: all 0.2s ease;
    }
    
    .menu-item:hover {
      transform: translateX(5px);
    }
    
    .card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 90%;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .modal-overlay {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .loading-spinner {
      border: 3px solid #f3f4f6;
      border-top: 3px solid #3b82f6;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hamburger {
      display: none;
    }
    
    @media (max-width: 768px) {
      .hamburger {
        display: block;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 101;
        background: #3b82f6;
        color: white;
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gradient-to-br from-white via-blue-50 to-blue-100 h-full"><!-- Hamburger Menu --> <button id="hamburger" class="hamburger">
   <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
   </svg></button> <!-- Login Page -->
  <div id="loginPage" class="flex items-center justify-center min-h-screen p-4">
   <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
    <div class="text-center mb-8">
     <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-white text-4xl">üì¶</span>
     </div>
     <h1 class="text-3xl font-bold text-gray-800 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</h1>
     <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
    </div>
    <form id="loginForm">
     <div class="mb-4"><label class="block text-gray-700 font-medium mb-2" for="username">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label> <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
     </div>
     <div class="mb-6"><label class="block text-gray-700 font-medium mb-2" for="password">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
     </div><button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition duration-200"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
    </form>
    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
     <p class="text-sm text-gray-600 text-center"><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:</strong><br>
       ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: Admin | ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô: Admin1234</p>
    </div>
   </div>
  </div><!-- Main Application -->
  <div id="mainApp" class="hidden h-full"><!-- Sidebar -->
   <div id="sidebar" class="sidebar fixed left-0 top-0 h-full w-64 bg-gradient-to-b from-blue-700 via-blue-600 to-blue-500 text-white shadow-xl z-50">
    <div class="p-6 border-b border-blue-500">
     <div class="flex items-center space-x-3">
      <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center"><span class="text-2xl">üì¶</span>
      </div>
      <div>
       <h2 class="font-bold text-lg">‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</h2>
       <p class="text-sm text-blue-200">Admin Panel</p>
      </div>
     </div>
    </div>
    <nav class="p-4 overflow-y-auto" style="height: calc(100% - 120px);"><button onclick="showPage('dashboard')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üìä</span> <span>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span> </button> <button onclick="showPage('stock')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üì¶</span> <span>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏</span> </button> <button onclick="showPage('borrow')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üîÑ</span> <span>‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏</span> </button> <button onclick="showPage('disburse')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üì§</span> <span>‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏</span> </button> <button onclick="showPage('borrowHistory')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üìã</span> <span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</span> </button> <button onclick="showPage('disburseHistory')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üìÑ</span> <span>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</span> </button> <button onclick="showPage('statistics')" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-blue-500 mb-2 flex items-center space-x-3"> <span class="text-xl">üìà</span> <span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span> </button> <button onclick="logout()" class="menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-red-500 mt-8 flex items-center space-x-3"> <span class="text-xl">üö™</span> <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</span> </button>
    </nav>
   </div><!-- Main Content -->
   <div class="main-content ml-64 p-4 md:p-8 h-full overflow-auto"><!-- Dashboard Page -->
    <div id="dashboardPage" class="page">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
      <div class="card bg-gradient-to-br from-blue-400 to-blue-500 rounded-xl p-6 text-white shadow-lg">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-blue-50 text-sm mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
         <h3 class="text-3xl font-bold" id="totalItems">0</h3>
        </div>
        <div class="text-5xl opacity-80">
         üì¶
        </div>
       </div>
      </div>
      <div class="card bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl p-6 text-white shadow-lg">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-blue-50 text-sm mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p>
         <h3 class="text-3xl font-bold" id="totalBorrows">0</h3>
        </div>
        <div class="text-5xl opacity-80">
         üîÑ
        </div>
       </div>
      </div>
      <div class="card bg-gradient-to-br from-blue-600 to-blue-700 rounded-xl p-6 text-white shadow-lg">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-blue-50 text-sm mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</p>
         <h3 class="text-3xl font-bold" id="totalDisburses">0</h3>
        </div>
        <div class="text-5xl opacity-80">
         üì§
        </div>
       </div>
      </div>
      <div class="card bg-gradient-to-br from-blue-700 to-blue-800 rounded-xl p-6 text-white shadow-lg">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-blue-50 text-sm mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô</p>
         <h3 class="text-3xl font-bold" id="overdueItems">0</h3>
        </div>
        <div class="text-5xl opacity-80">
         ‚ö†Ô∏è
        </div>
       </div>
      </div>
     </div>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white rounded-xl shadow-lg p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
       <div id="overdueList" class="space-y-3"></div>
      </div>
      <div class="bg-white rounded-xl shadow-lg p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</h3>
       <div id="lowStockList" class="space-y-3"></div>
      </div>
     </div>
    </div><!-- Stock Page -->
    <div id="stockPage" class="page hidden">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏</h1>
     <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÉ‡∏´‡∏°‡πà</h3>
      <form id="addStockForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-gray-700 font-medium mb-2" for="itemName">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</label> <input type="text" id="itemName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏" required>
       </div>
       <div><label class="block text-gray-700 font-medium mb-2" for="itemQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏</label> <input type="number" id="itemQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0" required>
       </div>
       <div class="md:col-span-2"><button type="submit" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition duration-200"> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏ </button>
       </div>
      </form>
     </div>
     <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
       <h3 class="text-xl font-bold text-gray-800">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3><input type="text" id="searchStock" class="w-full md:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏...">
      </div>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="bg-gray-100">
         <tr>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="stockTableBody">
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Borrow Page -->
    <div id="borrowPage" class="page hidden">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏</h1>
     <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3>
      <form id="borrowForm">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowerName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏° <span class="text-red-500">*</span></label> <input type="text" id="borrowerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowerPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å) <span class="text-red-500">*</span></label> <input type="tel" id="borrowerPhone" maxlength="10" pattern="[0-9]{10}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowItem">‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° <span class="text-red-500">*</span></label> <select id="borrowItem" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏</option> </select>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° <span class="text-red-500">*</span></label> <input type="number" id="borrowQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="1" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° <span class="text-red-500">*</span></label> <input type="date" id="borrowDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="returnDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô <span class="text-red-500">*</span></label> <input type="date" id="returnDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowImage">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ß‡∏±‡∏™‡∏î‡∏∏ <span class="text-red-500">*</span></label> <input type="file" id="borrowImage" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
         <p class="text-sm text-gray-500 mt-1">‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB</p>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="borrowNote">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <input type="text" id="borrowNote" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
        </div>
       </div>
       <div class="mt-6"><button type="submit" class="w-full md:w-auto bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-2 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition duration-200"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° </button>
       </div>
      </form>
     </div>
    </div><!-- Disburse Page -->
    <div id="disbursePage" class="page hidden">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏</h1>
     <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
      <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3>
      <form id="disburseForm">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label class="block text-gray-700 font-medium mb-2" for="disburserName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å <span class="text-red-500">*</span></label> <input type="text" id="disburserName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="disburserPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å) <span class="text-red-500">*</span></label> <input type="tel" id="disburserPhone" maxlength="10" pattern="[0-9]{10}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 10 ‡∏´‡∏•‡∏±‡∏Å" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="disburseItem">‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å <span class="text-red-500">*</span></label> <select id="disburseItem" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏</option> </select>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="disburseQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å <span class="text-red-500">*</span></label> <input type="number" id="disburseQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="1" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="disburseDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å <span class="text-red-500">*</span></label> <input type="date" id="disburseDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
        </div>
        <div><label class="block text-gray-700 font-medium mb-2" for="disburseNote">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <input type="text" id="disburseNote" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
        </div>
       </div>
       <div class="mt-6"><button type="submit" class="w-full md:w-auto bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-2 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition duration-200"> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å </button>
       </div>
      </form>
     </div>
    </div><!-- Borrow History Page -->
    <div id="borrowHistoryPage" class="page hidden">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h1>
     <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
      <div class="flex flex-col md:flex-row flex-wrap gap-4 mb-4"><input type="text" id="searchBorrow" class="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."> <input type="date" id="filterStartDate" class="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="date" id="filterEndDate" class="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <button onclick="filterBorrowHistory()" class="bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-600">‡∏Å‡∏£‡∏≠‡∏á</button> <button onclick="clearBorrowFilter()" class="bg-gray-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-600">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
      </div>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="bg-gray-100">
         <tr>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="borrowHistoryBody">
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Disburse History Page -->
    <div id="disburseHistoryPage" class="page hidden">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</h1>
     <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
      <div class="flex flex-col md:flex-row flex-wrap gap-4 mb-4"><input type="text" id="searchDisburse" class="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..."> <input type="date" id="filterDisburseStartDate" class="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <input type="date" id="filterDisburseEndDate" class="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"> <button onclick="filterDisburseHistory()" class="bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-blue-600">‡∏Å‡∏£‡∏≠‡∏á</button> <button onclick="clearDisburseFilter()" class="bg-gray-500 text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-600">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
      </div>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="bg-gray-100">
         <tr>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
          <th class="px-4 py-3 text-left text-gray-700 font-semibold">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
         </tr>
        </thead>
        <tbody id="disburseHistoryBody">
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Statistics Page -->
    <div id="statisticsPage" class="page hidden">
     <h1 class="text-2xl md:text-4xl font-bold text-gray-800 mb-8">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h1>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
       <canvas id="borrowChart"></canvas>
      </div>
      <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-4">‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</h3>
       <canvas id="disburseChart"></canvas>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Footer -->
  <div id="footer" class="hidden ml-0 md:ml-64 bg-gradient-to-r from-blue-600 via-blue-500 to-blue-400 text-white py-4 px-4 md:px-8">
   <div class="text-center">
    <p class="font-medium text-sm md:text-base">‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ (Borrowing and Disbursement Management System)</p>
    <p class="text-xs md:text-sm text-blue-200">¬© <span id="currentYear"></span> All Rights Reserved</p>
   </div>
  </div><!-- Edit Stock Modal -->
  <div id="editStockModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
   <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-md">
    <h3 class="text-2xl font-bold text-gray-800 mb-6">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3>
    <form id="editStockForm"><input type="hidden" id="editStockId">
     <div class="mb-4"><label class="block text-gray-700 font-medium mb-2" for="editItemName">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</label> <input type="text" id="editItemName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
     </div>
     <div class="mb-6"><label class="block text-gray-700 font-medium mb-2" for="editItemQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏</label> <input type="number" id="editItemQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" required>
     </div>
     <div class="flex flex-col md:flex-row gap-4"><button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button> <button type="button" onclick="closeEditStockModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Edit Borrow Modal -->
  <div id="editBorrowModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
   <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-2xl max-h-screen overflow-y-auto">
    <h3 class="text-2xl font-bold text-gray-800 mb-6">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h3>
    <form id="editBorrowForm"><input type="hidden" id="editBorrowId">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-gray-700 font-medium mb-2" for="editBorrowerName">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</label> <input type="text" id="editBorrowerName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editBorrowerPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å)</label> <input type="tel" id="editBorrowerPhone" maxlength="10" pattern="[0-9]{10}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editBorrowQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</label> <input type="number" id="editBorrowQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editBorrowDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</label> <input type="date" id="editBorrowDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editReturnDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</label> <input type="date" id="editReturnDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editBorrowNote">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <input type="text" id="editBorrowNote" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
     </div>
     <div class="flex flex-col md:flex-row gap-4 mt-6"><button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button> <button type="button" onclick="closeEditBorrowModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Edit Disburse Modal -->
  <div id="editDisburseModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
   <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-2xl max-h-screen overflow-y-auto">
    <h3 class="text-2xl font-bold text-gray-800 mb-6">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</h3>
    <form id="editDisburseForm"><input type="hidden" id="editDisburseId">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-gray-700 font-medium mb-2" for="editDisburserName">‡∏ä‡∏∑ÔøΩÔøΩÔøΩÔøΩ‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å</label> <input type="text" id="editDisburserName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editDisburserPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å)</label> <input type="tel" id="editDisburserPhone" maxlength="10" pattern="[0-9]{10}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editDisburseQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</label> <input type="number" id="editDisburseQuantity" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" required>
      </div>
      <div><label class="block text-gray-700 font-medium mb-2" for="editDisburseDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å</label> <input type="date" id="editDisburseDate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div class="md:col-span-2"><label class="block text-gray-700 font-medium mb-2" for="editDisburseNote">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <input type="text" id="editDisburseNote" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
     </div>
     <div class="flex flex-col md:flex-row gap-4 mt-6"><button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg font-semibold hover:bg-blue-600">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button> <button type="button" onclick="closeEditDisburseModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
     </div>
    </form>
   </div>
  </div><!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center z-50 p-4">
   <div class="bg-white rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-md">
    <div class="text-center mb-6">
     <div class="w-16 h-16 bg-red-100 rounded-full mx-auto mb-4 flex items-center justify-center"><span class="text-4xl">‚ö†Ô∏è</span>
     </div>
     <h3 class="text-2xl font-bold text-gray-800 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
     <p class="text-gray-600">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?</p>
    </div>
    <div class="flex flex-col md:flex-row gap-4"><button onclick="confirmDelete()" class="flex-1 bg-red-500 text-white py-2 rounded-lg font-semibold hover:bg-red-600">‡∏•‡∏ö</button> <button onclick="closeDeleteModal()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg font-semibold hover:bg-gray-600">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
   </div>
  </div><!-- Loading Overlay -->
  <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
   <div class="bg-white rounded-xl p-8 flex flex-col items-center">
    <div class="loading-spinner mb-4"></div>
    <p class="text-gray-700 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
   </div>
  </div>
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDEu5saoBSxaYe9dNKojpPOXQo_TNlbNwc",
      authDomain: "borrowingdisbursementsystem.firebaseapp.com",
      projectId: "borrowingdisbursementsystem",
      storageBucket: "borrowingdisbursementsystem.firebasestorage.app",
      messagingSenderId: "687862306234",
      appId: "1:687862306234:web:1c170918b89e2e28b13983",
      measurementId: "G-2V05JG43KP"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Global variables
    let currentDeleteId = null;
    let currentDeleteType = null;
    let currentDeleteData = null;
    let borrowChart = null;
    let disburseChart = null;

    // Mobile menu toggle
    document.getElementById('hamburger').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('active');
    });

    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', (e) => {
      const sidebar = document.getElementById('sidebar');
      const hamburger = document.getElementById('hamburger');
      
      if (window.innerWidth <= 768 && 
          !sidebar.contains(e.target) && 
          !hamburger.contains(e.target) &&
          sidebar.classList.contains('active')) {
        sidebar.classList.remove('active');
      }
    });

    // Login Handler
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      if (username === 'Admin' && password === 'Admin1234') {
        document.getElementById('loginPage').classList.add('hidden');
        document.getElementById('mainApp').classList.remove('hidden');
        document.getElementById('footer').classList.remove('hidden');
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        showPage('dashboard');
        loadAllData();
        showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      } else {
        showToast('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
      }
    });

    // Logout
    function logout() {
      document.getElementById('mainApp').classList.add('hidden');
      document.getElementById('footer').classList.add('hidden');
      document.getElementById('loginPage').classList.remove('hidden');
      document.getElementById('loginForm').reset();
      showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
    }

    // Show Page
    function showPage(pageName) {
      // Close mobile menu
      if (window.innerWidth <= 768) {
        document.getElementById('sidebar').classList.remove('active');
      }
      
      document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
      document.getElementById(pageName + 'Page').classList.remove('hidden');
      
      if (pageName === 'dashboard') {
        loadDashboard();
      } else if (pageName === 'stock') {
        loadStock();
      } else if (pageName === 'borrow') {
        loadBorrowForm();
      } else if (pageName === 'disburse') {
        loadDisburseForm();
      } else if (pageName === 'borrowHistory') {
        loadBorrowHistory();
      } else if (pageName === 'disburseHistory') {
        loadDisburseHistory();
      } else if (pageName === 'statistics') {
        loadStatistics();
      }
    }

    // Toast Notification
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      };
      
      toast.classList.add(colors[type]);
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    // Loading Overlay
    function showLoading() {
      document.getElementById('loadingOverlay').classList.remove('hidden');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.add('hidden');
    }

    // Resize Image Function
    function resizeImage(file, maxWidth, maxHeight) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            if (width > height) {
              if (width > maxWidth) {
                height *= maxWidth / width;
                width = maxWidth;
              }
            } else {
              if (height > maxHeight) {
                width *= maxHeight / height;
                height = maxHeight;
              }
            }
            
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            canvas.toBlob((blob) => {
              resolve(blob);
            }, file.type, 0.7);
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Add Stock
    document.getElementById('addStockForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('itemName').value.trim();
      const quantity = parseInt(document.getElementById('itemQuantity').value);
      
      if (!name) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏', 'error');
        return;
      }
      
      if (quantity < 0) {
        showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö', 'error');
        return;
      }
      
      showLoading();
      
      try {
        await db.collection('stock').add({
          name: name,
          quantity: quantity,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        document.getElementById('addStockForm').reset();
        loadStock();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    });

    // Load Stock
    function loadStock() {
      db.collection('stock').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
        const tbody = document.getElementById('stockTableBody');
        tbody.innerHTML = '';
        
        snapshot.forEach((doc) => {
          const data = doc.data();
          const row = tbody.insertRow();
          
          row.innerHTML = `
            <td class="px-4 py-3 text-gray-800">${data.name}</td>
            <td class="px-4 py-3 text-gray-800">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
            <td class="px-4 py-3">
              <button onclick="editStock('${doc.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 mr-2 text-sm md:text-base">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button onclick="deleteStock('${doc.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm md:text-base">‡∏•‡∏ö</button>
            </td>
          `;
        });
        
        // Search functionality
        document.getElementById('searchStock').addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          const rows = tbody.querySelectorAll('tr');
          
          rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
          });
        });
      });
    }

    // Edit Stock
    async function editStock(id) {
      const doc = await db.collection('stock').doc(id).get();
      const data = doc.data();
      
      document.getElementById('editStockId').value = id;
      document.getElementById('editItemName').value = data.name;
      document.getElementById('editItemQuantity').value = data.quantity;
      document.getElementById('editStockModal').classList.remove('hidden');
    }

    document.getElementById('editStockForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('editStockId').value;
      const name = document.getElementById('editItemName').value.trim();
      const quantity = parseInt(document.getElementById('editItemQuantity').value);
      
      if (!name) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏', 'error');
        return;
      }
      
      if (quantity < 0) {
        showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö', 'error');
        return;
      }
      
      showLoading();
      
      try {
        await db.collection('stock').doc(id).update({
          name: name,
          quantity: quantity
        });
        
        showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        closeEditStockModal();
        loadStock();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    });

    function closeEditStockModal() {
      document.getElementById('editStockModal').classList.add('hidden');
      document.getElementById('editStockForm').reset();
    }

    // Delete Stock
    async function deleteStock(id) {
      currentDeleteId = id;
      currentDeleteType = 'stock';
      currentDeleteData = null;
      document.getElementById('deleteModal').classList.remove('hidden');
    }

    async function confirmDelete() {
      if (!currentDeleteId || !currentDeleteType) return;
      
      showLoading();
      
      try {
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢
        if (currentDeleteType === 'stock') {
          // ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°
          const borrowsSnapshot = await db.collection('borrows').where('itemId', '==', currentDeleteId).get();
          const borrowDeletePromises = borrowsSnapshot.docs.map(doc => doc.ref.delete());
          await Promise.all(borrowDeletePromises);
          
          // ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
          const disbursesSnapshot = await db.collection('disburses').where('itemId', '==', currentDeleteId).get();
          const disburseDeletePromises = disbursesSnapshot.docs.map(doc => doc.ref.delete());
          await Promise.all(disburseDeletePromises);
        }
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å
        if (currentDeleteType === 'borrows' && currentDeleteData) {
          const stockDoc = await db.collection('stock').doc(currentDeleteData.itemId).get();
          if (stockDoc.exists) {
            await db.collection('stock').doc(currentDeleteData.itemId).update({
              quantity: firebase.firestore.FieldValue.increment(currentDeleteData.quantity)
            });
          }
        }
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å
        if (currentDeleteType === 'disburses' && currentDeleteData) {
          const stockDoc = await db.collection('stock').doc(currentDeleteData.itemId).get();
          if (stockDoc.exists) {
            await db.collection('stock').doc(currentDeleteData.itemId).update({
              quantity: firebase.firestore.FieldValue.increment(currentDeleteData.quantity)
            });
          }
        }
        
        await db.collection(currentDeleteType).doc(currentDeleteId).delete();
        showToast('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        closeDeleteModal();
        
        if (currentDeleteType === 'stock') {
          loadStock();
        } else if (currentDeleteType === 'borrows') {
          loadBorrowHistory();
        } else if (currentDeleteType === 'disburses') {
          loadDisburseHistory();
        }
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }

    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.add('hidden');
      currentDeleteId = null;
      currentDeleteType = null;
      currentDeleteData = null;
    }

    // Load Borrow Form
    function loadBorrowForm() {
      const select = document.getElementById('borrowItem');
      select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏</option>';
      
      db.collection('stock').get().then((snapshot) => {
        snapshot.forEach((doc) => {
          const data = doc.data();
          const option = document.createElement('option');
          option.value = doc.id;
          option.textContent = `${data.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô)`;
          option.dataset.maxQuantity = data.quantity;
          select.appendChild(option);
        });
      });
      
      // Set default dates
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('borrowDate').value = today;
      
      const nextWeek = new Date();
      nextWeek.setDate(nextWeek.getDate() + 7);
      document.getElementById('returnDate').value = nextWeek.toISOString().split('T')[0];
    }

    // Add Borrow
    document.getElementById('borrowForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const borrowerName = document.getElementById('borrowerName').value.trim();
      const borrowerPhone = document.getElementById('borrowerPhone').value.trim();
      const itemId = document.getElementById('borrowItem').value;
      const quantity = parseInt(document.getElementById('borrowQuantity').value);
      const borrowDate = document.getElementById('borrowDate').value;
      const returnDate = document.getElementById('returnDate').value;
      const note = document.getElementById('borrowNote').value.trim();
      const imageFile = document.getElementById('borrowImage').files[0];
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
      if (!borrowerName) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°', 'error');
        return;
      }
      
      if (!borrowerPhone) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', 'error');
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å
      if (!/^\d{10}$/.test(borrowerPhone)) {
        showToast('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        return;
      }
      
      if (!itemId) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', 'error');
        return;
      }
      
      if (!quantity || quantity <= 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)', 'error');
        return;
      }
      
      if (!borrowDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', 'error');
        return;
      }
      
      if (!returnDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô', 'error');
        return;
      }
      
      if (!imageFile) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ß‡∏±‡∏™‡∏î‡∏∏', 'error');
        return;
      }
      
      const selectedOption = document.getElementById('borrowItem').selectedOptions[0];
      const maxQuantity = parseInt(selectedOption.dataset.maxQuantity);
      
      if (quantity > maxQuantity) {
        showToast(`‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${maxQuantity} ‡∏ä‡∏¥‡πâ‡∏ô)`, 'error');
        return;
      }
      
      if (new Date(returnDate) <= new Date(borrowDate)) {
        showToast('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', 'error');
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB
      if (imageFile.size > 5 * 1024 * 1024) {
        showToast('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB', 'error');
        return;
      }
      
      showLoading();
      
      try {
        const itemDoc = await db.collection('stock').doc(itemId).get();
        const itemData = itemDoc.data();
        
        let imageUrl = '';
        // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏£‡πâ‡∏≠‡∏° timeout ‡πÅ‡∏•‡∏∞ compression
        try {
          const resizedImage = await resizeImage(imageFile, 800, 800);
          const storageRef = storage.ref();
          const imageRef = storageRef.child(`borrow-images/${Date.now()}_${imageFile.name}`);
          
          const uploadTask = imageRef.put(resizedImage);
          
          // ‡πÉ‡∏ä‡πâ Promise ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
          await new Promise((resolve, reject) => {
            const timeout = setTimeout(() => {
              reject(new Error('‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏ûÔøΩÔøΩÔøΩ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ'));
            }, 30000); // 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            
            uploadTask.on('state_changed', 
              null,
              (error) => {
                clearTimeout(timeout);
                reject(error);
              },
              async () => {
                clearTimeout(timeout);
                imageUrl = await uploadTask.snapshot.ref.getDownloadURL();
                resolve();
              }
            );
          });
        } catch (uploadError) {
          hideLoading();
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û: ' + uploadError.message, 'error');
          return;
        }
        
        await db.collection('borrows').add({
          borrowerName: borrowerName,
          borrowerPhone: borrowerPhone,
          itemId: itemId,
          itemName: itemData.name,
          quantity: quantity,
          borrowDate: borrowDate,
          returnDate: returnDate,
          actualReturnDate: null,
          note: note,
          imageUrl: imageUrl,
          status: 'borrowing',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        await db.collection('stock').doc(itemId).update({
          quantity: firebase.firestore.FieldValue.increment(-quantity)
        });
        
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        document.getElementById('borrowForm').reset();
        loadBorrowForm();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    });

    // Load Disburse Form
    function loadDisburseForm() {
      const select = document.getElementById('disburseItem');
      select.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏</option>';
      
      db.collection('stock').get().then((snapshot) => {
        snapshot.forEach((doc) => {
          const data = doc.data();
          const option = document.createElement('option');
          option.value = doc.id;
          option.textContent = `${data.name} (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô)`;
          option.dataset.maxQuantity = data.quantity;
          select.appendChild(option);
        });
      });
      
      // Set default date
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('disburseDate').value = today;
    }

    // Add Disburse
    document.getElementById('disburseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const disburserName = document.getElementById('disburserName').value.trim();
      const disburserPhone = document.getElementById('disburserPhone').value.trim();
      const itemId = document.getElementById('disburseItem').value;
      const quantity = parseInt(document.getElementById('disburseQuantity').value);
      const disburseDate = document.getElementById('disburseDate').value;
      const note = document.getElementById('disburseNote').value.trim();
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
      if (!disburserName) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å', 'error');
        return;
      }
      
      if (!disburserPhone) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', 'error');
        return;
      }
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å
      if (!/^\d{10}$/.test(disburserPhone)) {
        showToast('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        return;
      }
      
      if (!itemId) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏µÔøΩÔøΩÔøΩ‡πÄ‡∏ö‡∏¥‡∏Å', 'error');
        return;
      }
      
      if (!quantity || quantity <= 0) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å (‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0)', 'error');
        return;
      }
      
      if (!disburseDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å', 'error');
        return;
      }
      
      const selectedOption = document.getElementById('disburseItem').selectedOptions[0];
      const maxQuantity = parseInt(selectedOption.dataset.maxQuantity);
      
      if (quantity > maxQuantity) {
        showToast(`‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${maxQuantity} ‡∏ä‡∏¥‡πâ‡∏ô)`, 'error');
        return;
      }
      
      showLoading();
      
      try {
        const itemDoc = await db.collection('stock').doc(itemId).get();
        const itemData = itemDoc.data();
        
        await db.collection('disburses').add({
          disburserName: disburserName,
          disburserPhone: disburserPhone,
          itemId: itemId,
          itemName: itemData.name,
          quantity: quantity,
          disburseDate: disburseDate,
          note: note,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        await db.collection('stock').doc(itemId).update({
          quantity: firebase.firestore.FieldValue.increment(-quantity)
        });
        
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        document.getElementById('disburseForm').reset();
        loadDisburseForm();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    });

    // Load Borrow History
    function loadBorrowHistory() {
      db.collection('borrows').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
        const tbody = document.getElementById('borrowHistoryBody');
        tbody.innerHTML = '';
        
        snapshot.forEach((doc) => {
          const data = doc.data();
          const row = tbody.insertRow();
          
          const status = getBorrowStatus(data);
          const statusBadge = getStatusBadge(status);
          
          row.innerHTML = `
            <td class="px-4 py-3 text-gray-800">${data.borrowerName}</td>
            <td class="px-4 py-3 text-gray-800">${data.borrowerPhone}</td>
            <td class="px-4 py-3 text-gray-800">${data.itemName}</td>
            <td class="px-4 py-3 text-gray-800">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
            <td class="px-4 py-3 text-gray-800">${formatDate(data.borrowDate)}</td>
            <td class="px-4 py-3 text-gray-800">${data.actualReturnDate ? formatDate(data.actualReturnDate) : formatDate(data.returnDate)}</td>
            <td class="px-4 py-3">${statusBadge}</td>
            <td class="px-4 py-3">
              <div class="flex flex-col md:flex-row gap-2">
                ${data.status === 'borrowing' ? `<button onclick="returnItem('${doc.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm">‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏™ÔøΩÔøΩÔøΩ‡∏∏</button>` : ''}
                <button onclick="editBorrow('${doc.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button onclick="deleteBorrow('${doc.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">‡∏•‡∏ö</button>
              </div>
            </td>
          `;
        });
        
        // Search functionality
        document.getElementById('searchBorrow').addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          const rows = tbody.querySelectorAll('tr');
          
          rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
          });
        });
      });
    }

    // Edit Borrow
    async function editBorrow(id) {
      const doc = await db.collection('borrows').doc(id).get();
      const data = doc.data();
      
      document.getElementById('editBorrowId').value = id;
      document.getElementById('editBorrowerName').value = data.borrowerName;
      document.getElementById('editBorrowerPhone').value = data.borrowerPhone;
      document.getElementById('editBorrowQuantity').value = data.quantity;
      document.getElementById('editBorrowDate').value = data.borrowDate;
      document.getElementById('editReturnDate').value = data.returnDate;
      document.getElementById('editBorrowNote').value = data.note || '';
      document.getElementById('editBorrowModal').classList.remove('hidden');
    }

    document.getElementById('editBorrowForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('editBorrowId').value;
      const borrowerName = document.getElementById('editBorrowerName').value.trim();
      const borrowerPhone = document.getElementById('editBorrowerPhone').value.trim();
      const quantity = parseInt(document.getElementById('editBorrowQuantity').value);
      const borrowDate = document.getElementById('editBorrowDate').value;
      const returnDate = document.getElementById('editReturnDate').value;
      const note = document.getElementById('editBorrowNote').value.trim();
      
      if (!borrowerName || !borrowerPhone || !borrowDate || !returnDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
        return;
      }
      
      if (!/^\d{10}$/.test(borrowerPhone)) {
        showToast('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        return;
      }
      
      if (quantity <= 0) {
        showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0', 'error');
        return;
      }
      
      if (new Date(returnDate) <= new Date(borrowDate)) {
        showToast('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ßÔøΩÔøΩ‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', 'error');
        return;
      }
      
      showLoading();
      
      try {
        await db.collection('borrows').doc(id).update({
          borrowerName: borrowerName,
          borrowerPhone: borrowerPhone,
          quantity: quantity,
          borrowDate: borrowDate,
          returnDate: returnDate,
          note: note
        });
        
        showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        closeEditBorrowModal();
        loadBorrowHistory();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    });

    function closeEditBorrowModal() {
      document.getElementById('editBorrowModal').classList.add('hidden');
      document.getElementById('editBorrowForm').reset();
    }

    // Delete Borrow
    async function deleteBorrow(id) {
      const doc = await db.collection('borrows').doc(id).get();
      const data = doc.data();
      
      currentDeleteId = id;
      currentDeleteType = 'borrows';
      currentDeleteData = data;
      document.getElementById('deleteModal').classList.remove('hidden');
    }

    // Get Borrow Status
    function getBorrowStatus(data) {
      if (data.status === 'returned') return 'returned';
      
      const today = new Date();
      const returnDate = new Date(data.returnDate);
      const daysUntilReturn = Math.ceil((returnDate - today) / (1000 * 60 * 60 * 24));
      
      if (daysUntilReturn < 0) return 'overdue';
      if (daysUntilReturn <= 3) return 'nearDue';
      return 'borrowing';
    }

    // Get Status Badge
    function getStatusBadge(status) {
      const badges = {
        borrowing: '<span class="status-badge bg-blue-100 text-blue-800">‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà</span>',
        returned: '<span class="status-badge bg-green-100 text-green-800">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>',
        nearDue: '<span class="status-badge bg-yellow-100 text-yellow-800">‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î</span>',
        overdue: '<span class="status-badge bg-red-100 text-red-800">‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô</span>'
      };
      
      return badges[status] || '';
    }

    // Return Item
    async function returnItem(id) {
      showLoading();
      
      try {
        const doc = await db.collection('borrows').doc(id).get();
        const data = doc.data();
        
        await db.collection('borrows').doc(id).update({
          status: 'returned',
          actualReturnDate: new Date().toISOString().split('T')[0]
        });
        
        await db.collection('stock').doc(data.itemId).update({
          quantity: firebase.firestore.FieldValue.increment(data.quantity)
        });
        
        showToast('‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        loadBorrowHistory();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }

    // Filter Borrow History
    function filterBorrowHistory() {
      const startDate = document.getElementById('filterStartDate').value;
      const endDate = document.getElementById('filterEndDate').value;
      
      if (!startDate || !endDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±ÔøΩÔøΩ‡∏ó‡∏µ‡πà', 'warning');
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        showToast('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'error');
        return;
      }
      
      db.collection('borrows')
        .where('borrowDate', '>=', startDate)
        .where('borrowDate', '<=', endDate)
        .get()
        .then((snapshot) => {
          const tbody = document.getElementById('borrowHistoryBody');
          tbody.innerHTML = '';
          
          snapshot.forEach((doc) => {
            const data = doc.data();
            const row = tbody.insertRow();
            
            const status = getBorrowStatus(data);
            const statusBadge = getStatusBadge(status);
            
            row.innerHTML = `
              <td class="px-4 py-3 text-gray-800">${data.borrowerName}</td>
              <td class="px-4 py-3 text-gray-800">${data.borrowerPhone}</td>
              <td class="px-4 py-3 text-gray-800">${data.itemName}</td>
              <td class="px-4 py-3 text-gray-800">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
              <td class="px-4 py-3 text-gray-800">${formatDate(data.borrowDate)}</td>
              <td class="px-4 py-3 text-gray-800">${data.actualReturnDate ? formatDate(data.actualReturnDate) : formatDate(data.returnDate)}</td>
              <td class="px-4 py-3">${statusBadge}</td>
              <td class="px-4 py-3">
                <div class="flex flex-col md:flex-row gap-2">
                  ${data.status === 'borrowing' ? `<button onclick="returnItem('${doc.id}')" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm">‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏™‡∏î‡∏∏</button>` : ''}
                  <button onclick="editBorrow('${doc.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button onclick="deleteBorrow('${doc.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">‡∏•‡∏ö</button>
                </div>
              </td>
            `;
          });
        });
    }

    function clearBorrowFilter() {
      document.getElementById('filterStartDate').value = '';
      document.getElementById('filterEndDate').value = '';
      loadBorrowHistory();
    }

    // Load Disburse History
    function loadDisburseHistory() {
      db.collection('disburses').orderBy('createdAt', 'desc').onSnapshot((snapshot) => {
        const tbody = document.getElementById('disburseHistoryBody');
        tbody.innerHTML = '';
        
        snapshot.forEach((doc) => {
          const data = doc.data();
          const row = tbody.insertRow();
          
          row.innerHTML = `
            <td class="px-4 py-3 text-gray-800">${data.disburserName}</td>
            <td class="px-4 py-3 text-gray-800">${data.disburserPhone}</td>
            <td class="px-4 py-3 text-gray-800">${data.itemName}</td>
            <td class="px-4 py-3 text-gray-800">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
            <td class="px-4 py-3 text-gray-800">${formatDate(data.disburseDate)}</td>
            <td class="px-4 py-3 text-gray-800">${data.note || '-'}</td>
            <td class="px-4 py-3">
              <div class="flex flex-col md:flex-row gap-2">
                <button onclick="editDisburse('${doc.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                <button onclick="deleteDisburse('${doc.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">‡∏•‡∏ö</button>
              </div>
            </td>
          `;
        });
        
        // Search functionality
        document.getElementById('searchDisburse').addEventListener('input', (e) => {
          const searchTerm = e.target.value.toLowerCase();
          const rows = tbody.querySelectorAll('tr');
          
          rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
          });
        });
      });
    }

    // Edit Disburse
    async function editDisburse(id) {
      const doc = await db.collection('disburses').doc(id).get();
      const data = doc.data();
      
      document.getElementById('editDisburseId').value = id;
      document.getElementById('editDisburserName').value = data.disburserName;
      document.getElementById('editDisburserPhone').value = data.disburserPhone;
      document.getElementById('editDisburseQuantity').value = data.quantity;
      document.getElementById('editDisburseDate').value = data.disburseDate;
      document.getElementById('editDisburseNote').value = data.note || '';
      document.getElementById('editDisburseModal').classList.remove('hidden');
    }

    document.getElementById('editDisburseForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const id = document.getElementById('editDisburseId').value;
      const disburserName = document.getElementById('editDisburserName').value.trim();
      const disburserPhone = document.getElementById('editDisburserPhone').value.trim();
      const quantity = parseInt(document.getElementById('editDisburseQuantity').value);
      const disburseDate = document.getElementById('editDisburseDate').value;
      const note = document.getElementById('editDisburseNote').value.trim();
      
      if (!disburserName || !disburserPhone || !disburseDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
        return;
      }
      
      if (!/^\d{10}$/.test(disburserPhone)) {
        showToast('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        return;
      }
      
      if (quantity <= 0) {
        showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0', 'error');
        return;
      }
      
      showLoading();
      
      try {
        await db.collection('disburses').doc(id).update({
          disburserName: disburserName,
          disburserPhone: disburserPhone,
          quantity: quantity,
          disburseDate: disburseDate,
          note: note
        });
        
        showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        closeEditDisburseModal();
        loadDisburseHistory();
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    });

    function closeEditDisburseModal() {
      document.getElementById('editDisburseModal').classList.add('hidden');
      document.getElementById('editDisburseForm').reset();
    }

    // Delete Disburse
    async function deleteDisburse(id) {
      const doc = await db.collection('disburses').doc(id).get();
      const data = doc.data();
      
      currentDeleteId = id;
      currentDeleteType = 'disburses';
      currentDeleteData = data;
      document.getElementById('deleteModal').classList.remove('hidden');
    }

    // Filter Disburse History
    function filterDisburseHistory() {
      const startDate = document.getElementById('filterDisburseStartDate').value;
      const endDate = document.getElementById('filterDisburseEndDate').value;
      
      if (!startDate || !endDate) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà', 'warning');
        return;
      }
      
      if (new Date(endDate) < new Date(startDate)) {
        showToast('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'error');
        return;
      }
      
      db.collection('disburses')
        .where('disburseDate', '>=', startDate)
        .where('disburseDate', '<=', endDate)
        .get()
        .then((snapshot) => {
          const tbody = document.getElementById('disburseHistoryBody');
          tbody.innerHTML = '';
          
          snapshot.forEach((doc) => {
            const data = doc.data();
            const row = tbody.insertRow();
            
            row.innerHTML = `
              <td class="px-4 py-3 text-gray-800">${data.disburserName}</td>
              <td class="px-4 py-3 text-gray-800">${data.disburserPhone}</td>
              <td class="px-4 py-3 text-gray-800">${data.itemName}</td>
              <td class="px-4 py-3 text-gray-800">${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</td>
              <td class="px-4 py-3 text-gray-800">${formatDate(data.disburseDate)}</td>
              <td class="px-4 py-3 text-gray-800">${data.note || '-'}</td>
              <td class="px-4 py-3">
                <div class="flex flex-col md:flex-row gap-2">
                  <button onclick="editDisburse('${doc.id}')" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 text-sm">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button onclick="deleteDisburse('${doc.id}')" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">‡∏•‡∏ö</button>
                </div>
              </td>
            `;
          });
        });
    }

    function clearDisburseFilter() {
      document.getElementById('filterDisburseStartDate').value = '';
      document.getElementById('filterDisburseEndDate').value = '';
      loadDisburseHistory();
    }

    // Load Dashboard
    async function loadDashboard() {
      const stockSnapshot = await db.collection('stock').get();
      const borrowsSnapshot = await db.collection('borrows').get();
      const disbursesSnapshot = await db.collection('disburses').get();
      
      document.getElementById('totalItems').textContent = stockSnapshot.size;
      document.getElementById('totalBorrows').textContent = borrowsSnapshot.size;
      document.getElementById('totalDisburses').textContent = disbursesSnapshot.size;
      
      let overdueCount = 0;
      const overdueList = document.getElementById('overdueList');
      overdueList.innerHTML = '';
      
      borrowsSnapshot.forEach((doc) => {
        const data = doc.data();
        const status = getBorrowStatus(data);
        
        if (status === 'overdue') {
          overdueCount++;
          const item = document.createElement('div');
          item.className = 'p-3 bg-red-50 rounded-lg border border-red-200';
          item.innerHTML = `
            <p class="font-medium text-red-800">${data.borrowerName} - ${data.itemName}</p>
            <p class="text-sm text-red-600">‡∏¢‡∏∑‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${formatDate(data.borrowDate)} | ‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î: ${formatDate(data.returnDate)}</p>
          `;
          overdueList.appendChild(item);
        }
      });
      
      if (overdueCount === 0) {
        overdueList.innerHTML = '<p class="text-gray-500 text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô</p>';
      }
      
      document.getElementById('overdueItems').textContent = overdueCount;
      
      // Low stock items
      const lowStockList = document.getElementById('lowStockList');
      lowStockList.innerHTML = '';
      
      stockSnapshot.forEach((doc) => {
        const data = doc.data();
        if (data.quantity <= 5) {
          const item = document.createElement('div');
          item.className = 'p-3 bg-yellow-50 rounded-lg border border-yellow-200';
          item.innerHTML = `
            <p class="font-medium text-yellow-800">${data.name}</p>
            <p class="text-sm text-yellow-600">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${data.quantity} ‡∏ä‡∏¥‡πâ‡∏ô</p>
          `;
          lowStockList.appendChild(item);
        }
      });
      
      if (lowStockList.children.length === 0) {
        lowStockList.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>';
      }
    }

    // Load Statistics
    async function loadStatistics() {
      const borrowsSnapshot = await db.collection('borrows').get();
      const disbursesSnapshot = await db.collection('disburses').get();
      
      // Count borrows by item
      const borrowCounts = {};
      borrowsSnapshot.forEach((doc) => {
        const data = doc.data();
        if (borrowCounts[data.itemName]) {
          borrowCounts[data.itemName] += data.quantity;
        } else {
          borrowCounts[data.itemName] = data.quantity;
        }
      });
      
      // Count disburses by item
      const disburseCounts = {};
      disbursesSnapshot.forEach((doc) => {
        const data = doc.data();
        if (disburseCounts[data.itemName]) {
          disburseCounts[data.itemName] += data.quantity;
        } else {
          disburseCounts[data.itemName] = data.quantity;
        }
      });
      
      // Sort and get top 5
      const topBorrows = Object.entries(borrowCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      const topDisburses = Object.entries(disburseCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      // Borrow Chart
      if (borrowChart) {
        borrowChart.destroy();
      }
      
      const borrowCtx = document.getElementById('borrowChart').getContext('2d');
      borrowChart = new Chart(borrowCtx, {
        type: 'bar',
        data: {
          labels: topBorrows.map(item => item[0]),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°',
            data: topBorrows.map(item => item[1]),
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
      
      // Disburse Chart
      if (disburseChart) {
        disburseChart.destroy();
      }
      
      const disburseCtx = document.getElementById('disburseChart').getContext('2d');
      disburseChart = new Chart(disburseCtx, {
        type: 'bar',
        data: {
          labels: topDisburses.map(item => item[0]),
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏ö‡∏¥‡∏Å',
            data: topDisburses.map(item => item[1]),
            backgroundColor: 'rgba(168, 85, 247, 0.8)',
            borderColor: 'rgba(168, 85, 247, 1)',
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 1
              }
            }
          }
        }
      });
    }

    // Format Date
    function formatDate(dateString) {
      const date = new Date(dateString);
      const day = date.getDate().toString().padStart(2, '0');
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const year = date.getFullYear() + 543;
      return `${day}/${month}/${year}`;
    }

    // Load All Data
    function loadAllData() {
      loadDashboard();
      loadStock();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9baa4dd9a36ba1c8',t:'MTc2Nzg2MDcyNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>